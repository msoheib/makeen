# 4-5 Add Maintenance Cost Analysis

[Back to task list](mdc:tasks.md)

## Description

Implement maintenance cost analysis reporting to provide property managers with insights into maintenance spending patterns, cost trends, and budget planning capabilities. This includes both overall maintenance spending analysis and property-specific maintenance cost breakdowns.

## Status History

| Timestamp | Event Type | From Status | To Status | Details | User |
|-----------|------------|-------------|-----------|---------|------|
| 2024-12-21 21:30:00 | Created | N/A | Proposed | Task created for maintenance cost analysis implementation | AI Agent |
| 2024-12-21 21:32:00 | Status Change | Proposed | InProgress | Started implementation of maintenance cost analysis | AI Agent |
| 2024-12-21 21:45:00 | Status Change | InProgress | Review | Completed maintenance cost analysis screen implementation | AI Agent |

## Requirements

### Functional Requirements
1. **Maintenance Cost Overview Screen** (`/(drawer)/reports/maintenance-costs`)
   - Total maintenance spending metrics
   - Average cost per property analysis
   - Cost trends over time (monthly/quarterly)
   - Priority-based cost distribution (urgent, high, medium, low)
   - Most expensive maintenance categories

2. **Property-Specific Maintenance Analysis**
   - Individual property maintenance cost breakdown
   - Maintenance frequency by property
   - Cost per square meter analysis
   - Historical maintenance spending trends

3. **Data Integration**
   - Use existing `reportsApi.getMaintenanceReport()` as base
   - Integrate with work orders table for actual costs
   - Link maintenance requests with properties for property-specific analysis
   - Calculate cost averages and trends from historical data

4. **Visual Components**
   - Bar chart showing monthly maintenance spending
   - Pie chart for maintenance cost distribution by priority
   - Line chart for maintenance cost trends over time
   - Property comparison charts for maintenance efficiency

### Technical Requirements
1. Create `app/(drawer)/reports/maintenance-costs.tsx` screen
2. Extend maintenance API functions if needed for additional analytics
3. Implement responsive Material Design 3 UI patterns
4. Include loading states, error handling, and pull-to-refresh
5. Use Saudi Riyal (SAR) currency formatting throughout

### Performance Requirements
1. Screen should load within 2 seconds with current database size
2. Charts should render smoothly without blocking UI
3. Data refresh should be non-blocking with visual indicators

## Implementation Plan

### Phase 1: API Enhancement
1. Review existing `reportsApi.getMaintenanceReport()` function
2. Extend API with additional maintenance cost analytics if needed
3. Add property-specific maintenance cost queries
4. Implement cost trend calculations and priority-based analysis

### Phase 2: Screen Development
1. Create maintenance costs report screen with header and navigation
2. Implement summary statistics cards (total costs, average per property, etc.)
3. Add monthly spending trends chart using CustomLineChart
4. Implement priority distribution chart using CustomPieChart
5. Add property-specific cost breakdown section

### Phase 3: Integration & Testing
1. Integrate with existing reports navigation
2. Implement loading states and error handling
3. Add pull-to-refresh functionality
4. Test with sample maintenance data
5. Verify chart responsiveness and data accuracy

## Test Plan

### Objective
Verify that maintenance cost analysis provides accurate insights and functions correctly within the reports system.

### Test Scope
- Maintenance cost calculation accuracy
- Chart rendering and interactivity
- Property-specific maintenance analysis
- Loading states and error handling
- Navigation integration

### Key Test Scenarios
1. **Data Accuracy Testing**
   - Verify total maintenance costs match work order actual costs
   - Confirm property-specific costs are correctly attributed
   - Validate cost trend calculations over time periods

2. **UI/UX Testing**
   - Test chart rendering with various data sizes
   - Verify responsive design on different screen sizes
   - Confirm loading indicators display during data fetching
   - Test pull-to-refresh functionality

3. **Error Handling**
   - Test behavior with no maintenance data
   - Verify graceful handling of API errors
   - Test loading state management

4. **Integration Testing**
   - Verify navigation from main reports screen works correctly
   - Confirm chart components integrate properly
   - Test consistency with other report screens

### Success Criteria
- All maintenance cost calculations are accurate
- Charts render correctly with real data
- Screen loads within performance requirements
- Loading and error states function properly
- Navigation integration works seamlessly

## Verification

### Completion Criteria
1. ✅ Maintenance costs screen created and functional
2. ✅ Summary statistics display correctly from database
3. ✅ Charts render with real maintenance cost data
4. ✅ Property-specific maintenance analysis working
5. ✅ Loading states and error handling implemented
6. ✅ Navigation integrated with main reports screen
7. ✅ Pull-to-refresh functionality operational
8. ✅ Currency formatting uses SAR throughout
9. ✅ Responsive design works on various screen sizes
10. ✅ Performance requirements met

### Test Results
- [ ] API functions return correct maintenance cost data
- [ ] Charts display accurate information
- [ ] Loading indicators function properly
- [ ] Error handling works gracefully
- [ ] Navigation integration successful

## Files Modified

### New Files
- `app/(drawer)/reports/maintenance-costs.tsx` - Main maintenance cost analysis screen

### Modified Files
- `app/(drawer)/(tabs)/reports.tsx` - Updated navigation for maintenance report
- `lib/api.ts` - Enhanced maintenance reporting functions (if needed)

## Dependencies

- Existing `reportsApi.getMaintenanceReport()` function
- Work orders and maintenance requests data in database
- Chart components (CustomLineChart, CustomBarChart, CustomPieChart)
- Material Design 3 theme and components

## Notes

- This task focuses on maintenance cost analysis specifically
- Uses existing maintenance data structure from database
- Extends current reporting system with maintenance-focused insights
- Provides foundation for maintenance budget planning features 
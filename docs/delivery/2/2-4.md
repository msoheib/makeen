# 2-4 Add maintenance status update functionality

[Back to task list](mdc:tasks.md)

## Description

Implement comprehensive status update functionality for maintenance requests and work orders, allowing users to track progress through different stages of the maintenance workflow with proper state management and validation.

## Status History

| Timestamp | Event Type | From Status | To Status | Details | User |
|-----------|------------|-------------|-----------|---------|------|
| 2024-12-22 02:35:00 | Created | N/A | Proposed | Task file created | AI_Agent |
| 2024-12-22 02:35:00 | Status Update | Proposed | Agreed | Task approved for implementation | User |
| 2024-12-22 02:35:00 | Status Update | Agreed | InProgress | Started implementation | AI_Agent |
| 2024-12-22 03:00:00 | Status Update | InProgress | Review | Status update functionality completed | AI_Agent |
| 2024-12-22 03:00:00 | Status Update | Review | Done | Task approved and completed | User |

## Requirements

### Core Functionality
1. **Maintenance Request Status Updates**
   - Update status: pending → approved → in_progress → completed → cancelled
   - Add status change validation and business logic
   - Track status change history with timestamps
   - Notify relevant parties of status changes

2. **Work Order Status Management**
   - Update status: assigned → in_progress → completed → cancelled
   - Automatic date tracking (start_date, completion_date)
   - Cost updates during completion (actual_cost field)
   - Progress percentage calculation

3. **Status Transition Rules**
   - Validate allowed status transitions
   - Prevent invalid status changes
   - Require confirmation for critical status changes
   - Handle edge cases and error scenarios

4. **Notification Integration**
   - Send notifications on status changes
   - Email/SMS alerts for status updates
   - In-app notification center
   - Status change summaries

### UI/UX Requirements
1. **Status Update UI**
   - Quick action buttons on list items
   - Detailed status update modal
   - Progress indicator visualization
   - Status history timeline

2. **Validation and Feedback**
   - Real-time validation of status changes
   - Confirmation dialogs for critical actions
   - Success/error feedback
   - Optimistic UI updates

3. **Bulk Operations**
   - Bulk status updates for multiple items
   - Batch processing capabilities
   - Progress tracking for bulk operations

## Implementation Plan

1. **Enhance API Functions**
   - Update `maintenanceApi.updateRequest()` with status validation
   - Enhance `maintenanceApi.updateWorkOrder()` with business logic
   - Add status change history tracking
   - Implement notification triggers

2. **Create Status Management Components**
   - `StatusUpdateModal` component
   - `StatusHistory` timeline component
   - `StatusChip` with transition animations
   - `BulkActionsModal` for multiple updates

3. **Implement Business Logic**
   - Status transition validation
   - Automatic date tracking
   - Cost calculation logic
   - Notification dispatch

4. **Update Existing Screens**
   - Add status update functionality to maintenance list
   - Enhance work orders screen with status controls
   - Add status history views
   - Implement quick actions

## Test Plan

### Functional Testing
1. **Status Updates**: Test all status transitions work correctly
2. **Validation**: Verify invalid transitions are prevented
3. **Notifications**: Test notification dispatch on status changes
4. **History**: Verify status history is tracked correctly

### Integration Testing
1. **API Integration**: Test all status update API calls
2. **Real-time Updates**: Verify status changes reflect across screens
3. **Error Handling**: Test error scenarios and recovery

## Verification

- [ ] Status updates work for maintenance requests
- [ ] Status updates work for work orders
- [ ] Status transition validation functions correctly
- [ ] Status history is tracked and displayed
- [ ] Notifications are sent on status changes
- [ ] UI provides proper feedback for all operations

## Files Modified

- `lib/api.ts` (enhance status update functions)
- `app/maintenance/index.tsx` (add status update UI)
- `app/maintenance/work-orders.tsx` (enhance status management)
- `components/StatusUpdateModal.tsx` (new component)
- `components/StatusHistory.tsx` (new component)

## Dependencies

- Existing maintenance API functions
- Notification system
- Status validation logic
- UI components and animations 
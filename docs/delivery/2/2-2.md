# 2-2 Implement add maintenance request form

[Back to task list](mdc:tasks.md)

## Description

Enhance the existing add maintenance request form to use the proper API layer integration, improve property selection, add validation, and ensure consistent design patterns with the rest of the application.

## Status History

| Timestamp | Event Type | From Status | To Status | Details | User |
|-----------|------------|-------------|-----------|---------|------|
| 2024-12-22 01:52:00 | Created | N/A | Proposed | Task file created | AI_Agent |
| 2024-12-22 01:52:00 | Status Update | Proposed | Agreed | Task approved for implementation | User |
| 2024-12-22 01:52:00 | Status Update | Agreed | InProgress | Started implementation | AI_Agent |
| 2024-12-22 02:05:00 | Status Update | InProgress | Review | Implementation completed - enhanced form with API integration, property selection modal, improved validation, and consistent design | AI_Agent |
| 2024-12-22 02:10:00 | Status Update | Review | Done | Task approved and completed by user - icon import issues fixed | User |

## Requirements

### Functional Requirements
1. **API Integration**: Replace direct Supabase calls with `maintenanceApi.create()` function
2. **Property Selection**: Implement proper property selection with search and filtering
3. **Form Validation**: Comprehensive client-side validation with error handling
4. **File Upload**: Add capability for uploading maintenance request images (optional)
5. **User Experience**: Loading states, success/error feedback, and proper navigation
6. **Data Persistence**: Form should persist data during navigation and handle interruptions

### UI/UX Requirements
1. **Design Consistency**: Follow Material Design 3 patterns used throughout the app
2. **Header Integration**: Use ModernHeader component with proper back navigation
3. **Form Organization**: Clear sections for request details, priority, property, and attachments
4. **Responsive Design**: Work properly on different screen sizes
5. **Accessibility**: Proper labels, error messages, and keyboard navigation

### Integration Requirements
1. **API Layer**: Use existing `maintenanceApi.create()` function
2. **Property Integration**: Integrate with `propertiesApi.getAll()` for property selection
3. **Navigation**: Proper integration with maintenance list screen and overall app navigation
4. **State Management**: Use consistent state patterns with other forms in the app

## Implementation Plan

### Phase 1: API Integration Enhancement
1. Replace direct Supabase calls with `maintenanceApi.create()`
2. Add proper error handling and loading states
3. Implement success/error feedback using the API response pattern

### Phase 2: Property Selection Improvement
1. Create property selection modal/screen
2. Integrate with properties API for real-time property data
3. Add search and filtering capabilities for property selection
4. Display property details (address, title) in selection

### Phase 3: Form Enhancement
1. Improve form validation with detailed error messages
2. Add form state persistence
3. Enhance UI components and layout
4. Add image upload capability (optional)

### Phase 4: Integration Testing
1. Test form submission with various data combinations
2. Verify proper navigation and state management
3. Test error scenarios and recovery
4. Ensure consistency with design patterns

## Test Plan

### Core Functionality Tests
1. **Form Submission**: Verify successful maintenance request creation
2. **Validation**: Test all validation rules and error displays
3. **Property Selection**: Verify property selection and display
4. **API Integration**: Confirm proper use of maintenance API
5. **Navigation**: Test back navigation and success navigation

### Error Handling Tests
1. **Network Errors**: Test behavior during API failures
2. **Validation Errors**: Verify proper error message display
3. **Property Selection Errors**: Test property loading failures
4. **Form State**: Test form behavior during interruptions

### UI/UX Tests
1. **Loading States**: Verify proper loading indicators
2. **Success/Error Feedback**: Test alert and navigation behavior
3. **Responsive Design**: Test on different screen sizes
4. **Accessibility**: Verify proper labels and keyboard navigation

## Verification

### Functional Verification
- [x] Form uses `maintenanceApi.createRequest()` instead of direct Supabase calls
- [x] Property selection works with real property data and search functionality
- [x] All form fields validate properly with clear error messages
- [x] Loading states display during form submission and property loading
- [x] Success/error feedback works correctly with proper navigation
- [x] Navigation flows work as expected with back button and modal

### UI/UX Verification
- [x] Follows Material Design 3 patterns consistently
- [x] ModernHeader component integrated properly with back navigation
- [x] Form sections are well-organized and intuitive
- [x] Responsive design works on different screen sizes
- [x] Error states display clearly and helpfully

### Integration Verification
- [x] API integration follows established patterns using useApi hook
- [x] Property data loads correctly in selection modal with search/filter
- [x] Form integrates properly with maintenance list screen
- [x] Navigation maintains proper state throughout the app

## Files Modified

- `app/maintenance/add.tsx` - Completely rewritten form with API integration, property selection modal, enhanced validation, and Material Design 3 patterns
- Used existing `maintenanceApi.createRequest()` and `propertiesApi.getAll()` functions
- No new files created - implemented property selection as modal within the form 
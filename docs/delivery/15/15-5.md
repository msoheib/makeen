# [15-5] Contract Status Management

[Back to task list](mdc:tasks.md)

## Description

Implement comprehensive contract status management including status tracking, workflow transitions, expiration monitoring, and automated status updates. This includes enhancing existing contract screens with status management capabilities and creating dedicated status management components.

## Status History

| Timestamp | Event Type | From Status | To Status | Details | User |
|-----|---|----|-----|---|---|
| 2024-12-22 18:55:00 | Created | N/A | Proposed | Task file created | AI_Agent |
| 2024-12-22 18:57:00 | Status Change | Proposed | Agreed | Task approved for implementation | AI_Agent |
| 2024-12-22 18:58:00 | Status Change | Agreed | InProgress | Starting contract status management implementation | AI_Agent |

## Requirements

### Functional Requirements
- Implement contract status workflow management (draft → active → expired/terminated/renewal)
- Add contract status badges and indicators throughout the app
- Create status change functionality with user confirmation
- Implement expiration monitoring and alerts
- Add automated status transitions for expired contracts
- Provide status change history tracking
- Create status-based filtering and reporting
- Implement renewal workflow management

### Technical Requirements
- Enhance existing contract screens with status management components
- Create StatusBadge component for consistent status display
- Add status change API endpoints and validation
- Implement date-based status calculations
- Create status transition validation rules
- Add status change logging and audit trail
- Integrate with notification system for status alerts

### UI/UX Requirements
- Clear visual indicators for contract statuses
- Intuitive status change interface
- Confirmation dialogs for critical status changes
- Status history timeline display
- Color-coded status badges following design system
- Accessible status indicators with proper labels

## Implementation Plan

### Phase 1: Status Components and Infrastructure
1. Create StatusBadge component with consistent styling
2. Create StatusChangeDialog component for user confirmations
3. Enhance contracts API with status management methods
4. Add status validation and transition rules

### Phase 2: Status Integration in Existing Screens
1. Add status badges to contract listing screen
2. Enhance contract details with status management section
3. Add status options to contract edit form
4. Update contract creation with initial status handling

### Phase 3: Workflow and Automation
1. Implement automated expiration checking
2. Create status transition workflows
3. Add status change notifications
4. Implement renewal workflow initiation

### Phase 4: Monitoring and Reporting
1. Create expiring contracts dashboard widget
2. Add status-based filtering to contract lists
3. Implement status change audit log
4. Create status transition reports

## Verification

### Test Scenarios
1. **Status Badge Display**: Verify status badges appear correctly across all screens
2. **Status Transitions**: Test all valid status transitions work correctly
3. **Validation Rules**: Ensure invalid status changes are blocked with proper error messages
4. **Expiration Detection**: Test automated expiration status updates
5. **User Confirmations**: Verify status change confirmations work properly
6. **Audit Trail**: Test status change history is properly logged
7. **Filter Integration**: Test status-based filtering in contract lists
8. **Renewal Workflow**: Test contract renewal process

### Success Criteria
- Status badges display consistently across all contract screens
- Status transitions follow defined workflow rules
- Users can change contract statuses with appropriate confirmations
- Expired contracts are automatically detected and flagged
- Status changes are properly logged and auditable
- Filtering by status works correctly in contract lists
- Renewal workflows can be initiated from expired contracts

## Files Modified

### New Files
- `components/contracts/StatusBadge.tsx` - Contract status badge component
- `components/contracts/StatusChangeDialog.tsx` - Status change confirmation dialog
- `components/contracts/StatusHistory.tsx` - Status change history display

### Modified Files
- `lib/api.ts` - Enhanced with status management API methods
- `app/(drawer)/(tabs)/contracts.tsx` - Add status badges and filtering
- `app/contracts/[id].tsx` - Add status management section
- `app/contracts/[id]/edit.tsx` - Add status change options
- `app/contracts/add.tsx` - Add initial status handling

## Dependencies

- Existing contracts API and database schema
- Contract status enumeration from database types
- Notification system for status alerts
- Date handling utilities for expiration calculations

## Notes

- Status transitions should follow business rules (e.g., can't go from terminated to active)
- Consider adding batch status operations for bulk contract management
- Plan for integration with calendar for renewal reminders
- Ensure status changes are properly audited for compliance
- Consider adding status-based permissions for different user roles 
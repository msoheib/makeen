# 5-5 Implement notification badges and counters

[Back to task list](mdc:tasks.md)

## Description

Implement notification badges and counters throughout the application to provide visual indicators of unread notifications. This includes badge counts on app icons, tab bars, navigation elements, and notification center headers. Users should be able to see at a glance how many unread notifications they have and in which categories.

## Status History

| Timestamp | Event Type | From Status | To Status | Details | User |
|-----------|------------|-------------|-----------|---------|------|
| 2024-12-24 23:50:00 | Created | N/A | Proposed | Task created for notification badges implementation | AI_Agent |
| 2024-12-24 23:52:00 | Status Update | Proposed | Agreed | Task approved and implementation plan confirmed | User |
| 2024-12-24 23:55:00 | Status Update | Agreed | InProgress | Started implementation | AI_Agent |
| 2024-12-25 00:15:00 | Status Update | InProgress | InProgress | Resuming implementation - creating badge components and service | AI_Agent |
| 2024-12-25 00:45:00 | Status Update | InProgress | Review | Core badge system implemented - service, hooks, components, and tab/header integration complete | AI_Agent |
| 2024-12-25 01:00:00 | Status Update | Review | Done | Task completed successfully - all badge functionality working as expected | User |

## Requirements

### Core Requirements
1. **App Icon Badge**: Show total unread count on app icon
2. **Tab Bar Badges**: Display notification count on relevant tabs
3. **Navigation Badges**: Show unread counts in navigation elements
4. **Category Badges**: Display counts per notification category
5. **Real-time Updates**: Immediate badge updates when notifications arrive/read
6. **Badge Styling**: Consistent Material Design 3 badge styling
7. **Performance**: Efficient badge count calculations
8. **Accessibility**: Proper accessibility labels for badges
9. **Badge Limits**: Handle large numbers gracefully (99+ display)
10. **Auto-clearing**: Remove badges when notifications are read

### Badge Locations
- App icon badge (mobile only)
- Notifications tab in bottom navigation
- Notification center header
- Settings screen notification option
- Individual category sections
- Hamburger menu bell icon

### Technical Requirements
- Real-time badge count updates
- Efficient database queries for counts
- Memory optimization for badge calculations
- Integration with notification preferences
- Respect user preferences for badge display
- Cross-platform badge support (iOS/Android/Web)

## Implementation Plan

### Phase 1: Badge Count Service
- Create badge calculation service
- Implement efficient count queries
- Add real-time count updates
- Cache badge counts for performance

### Phase 2: Badge Components
- Create reusable Badge component
- Implement different badge styles and sizes
- Add number formatting (99+ for large counts)
- Handle badge positioning and alignment

### Phase 3: Badge Integration
- Add badges to tab navigation
- Implement app icon badge
- Add badges to notification center
- Update header badges

### Phase 4: Real-time Updates
- Connect badges to notification events
- Update badges when notifications are read
- Sync badge counts across app screens
- Handle badge clearing on notification deletion

### Phase 5: Performance Optimization
- Optimize badge count calculations
- Implement efficient caching
- Minimize re-renders on badge updates
- Handle large notification datasets

## Test Plan

### Functionality Testing
1. **Badge Display**: Test badge visibility and count accuracy
2. **Real-time Updates**: Test immediate badge updates
3. **Badge Clearing**: Test badge removal when notifications read
4. **Large Numbers**: Test 99+ display for large counts
5. **App Icon Badge**: Test mobile app icon badge (iOS/Android)

### Integration Testing
1. **Navigation Integration**: Test tab bar and navigation badges
2. **Notification Center**: Test badge display in notification center
3. **Settings Integration**: Test badges in settings screens
4. **Performance**: Test badge updates with large datasets

### E2E Testing
1. **User Journey**: Complete notification badge lifecycle
2. **Cross-screen Sync**: Test badge consistency across screens
3. **Real-time Sync**: Test badge updates across multiple sessions
4. **Accessibility**: Test badge accessibility with screen readers

## Verification

### Implementation Checklist
- [ ] Badge count calculation service
- [ ] Reusable Badge component with Material Design 3 styling
- [ ] App icon badge implementation (mobile)
- [ ] Tab bar navigation badges
- [ ] Notification center header badges
- [ ] Category-specific badges
- [ ] Real-time badge count updates
- [ ] Badge count caching and optimization
- [ ] 99+ number formatting for large counts
- [ ] Badge accessibility labels

### Integration Checklist
- [ ] Tab navigation badge integration
- [ ] Drawer navigation badge integration
- [ ] Notification center badge display
- [ ] Settings screen badges
- [ ] Header component badge integration
- [ ] Cross-screen badge synchronization
- [ ] Real-time notification event integration
- [ ] Badge clearing on notification read

### Performance Checklist
- [ ] Efficient badge count calculations
- [ ] Badge count caching implementation
- [ ] Optimized re-rendering on badge updates
- [ ] Memory usage optimization
- [ ] Large dataset handling
- [ ] Cross-platform performance consistency

## Files to Create/Modify

### New Components
- `components/Badge.tsx` - Reusable badge component
- `components/NotificationBadge.tsx` - Specialized notification badge
- `hooks/useNotificationBadges.ts` - Badge count management hook

### Enhanced Services
- `lib/notificationBadges.ts` - Badge calculation service
- `hooks/useNotificationCenter.ts` - Add badge count integration

### Enhanced Components
- `components/ModernHeader.tsx` - Add badge support to header
- `components/SideBar.tsx` - Add notification badges to sidebar
- `app/(drawer)/_layout.tsx` - Add badge to drawer navigation
- `app/(drawer)/(tabs)/_layout.tsx` - Add badges to tab navigation

### Enhanced Screens
- `app/notifications/center.tsx` - Add badge counts to categories
- `app/notifications/index.tsx` - Display notification badges
- `app/(drawer)/(tabs)/index.tsx` - Add notification indicators

## Business Rules

### Badge Display Rules
1. **Zero Count**: No badge displayed when count is 0
2. **Small Numbers**: Display exact count for 1-99
3. **Large Numbers**: Display "99+" for counts >= 100
4. **Real-time**: Update immediately when notifications change
5. **Persistence**: Badge counts persist across app sessions
6. **Preferences**: Respect user badge display preferences

### Badge Styling
1. **Color**: Use theme error color for badge background
2. **Text**: White text on colored background
3. **Size**: Small (16px), Medium (20px), Large (24px)
4. **Position**: Top-right corner of parent element
5. **Animation**: Subtle scale animation on count changes

### Platform Considerations
1. **iOS**: Use iOS badge API for app icon badges
2. **Android**: Use Android notification badge API
3. **Web**: Visual badges only (no app icon badge)
4. **Expo**: Use Expo Notifications for app badge management

## Dependencies

### Requires Completion Of:
- Task 5-3: Create notification center UI âœ…
- Task 5-4: Add notification preferences system âœ…

### Enables:
- Task 5-6: Add notification routing and deep linking
- Task 5-7: Add notification categories and types
- Task 5-8: Implement notification testing system

---

**Status**: ðŸš§ **IN PROGRESS** - Implementing notification badges and counters system. 